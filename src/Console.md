# Console
---
你有没有意识到：你在学校学习的思科模拟器的IOS命令行，只需要点几下图标就有了。真机你哪怕给机器插上鼠标键盘也没反应。

**那咋办嘞？**

---
## Introducing: Console Port!
---
如你所见，几家网络设备都会在设备上预留**至少**一个RJ45的"网口"。上面写着console.

一些新设备会有一个USB Mini-B的端口，那个也能用，或者说其实更好用。

### 那是网口吗？

显然不是。

Console口本质上是一个RJ45形状的串口。

<details>
   <summary>想知道更多？点我吧。</summary>

## 思科 Console 口定义

---

### RJ45 引脚定义（标准）

思科设备的 Console 口（RJ45）引脚定义如下：

| 引脚 | 信号 | 方向 | 说明 |
|:----:|------|:----:|------|
| 1 | RTS | Output | 请求发送（与引脚8短接） |
| 2 | DTR | Output | 数据终端就绪（常开） |
| 3 | TXD | Output | 发送数据 |
| 4 | GND | — | 信号地 |
| 5 | GND | — | 信号地 |
| 6 | RXD | Input | 接收数据 |
| 7 | DSR | Input | 数据设备就绪（未使用） |
| 8 | CTS | Input | 清除发送（与引脚1短接） |

---

### 重要说明

#### 1. Rollover 线（反转线）
思科 Console 线是特殊的 **rollover 线**（也叫反转线）：
- 线序：一头引脚1对应另一头引脚8，引脚2对应引脚7，以此类推
- **普通网线（直通线）不能当 Console 线用**
- 如果你手头只有普通网线，临时应急可以试试，但大概率不通

#### 2. Console 口 vs AUX 口
| 接口 | 用途 | 引脚7状态 |
|------|------|----------|
| Console | 本地管理 | 未使用 |
| AUX | 远程拨号管理 | DSR/DCD |

外观都是 RJ45，插错可能不工作，但不会烧设备。

#### 3. Console 口 vs 普通网口
| 接口 | 信号类型 | 用途 |
|------|----------|------|
| Console | RS-232 串行信号 | 设备配置管理 |
| 普通网口 | 以太网信号 | 网络数据传输 |

插错口不会烧设备，但肯定连不上。别问我怎么知道的。

---

### 线缆对应关系

如果你非要自己做 Console 线（我还是建议直接买成品）：

| RJ45（Console口） | DB9（电脑串口） |
|-------------------|-----------------|
| 引脚1 RTS | 引脚8 CTS |
| 引脚2 DTR | 引脚6 DSR |
| 引脚3 TXD | 引脚2 RXD |
| 引脚4 GND | 引脚5 GND |
| 引脚5 GND | 引脚5 GND |
| 引脚6 RXD | 引脚3 TXD |
| 引脚8 CTS | 引脚7 RTS |

**引脚7 DSR 悬空，不用接。**

---

### 踩坑提醒

1. **USB转RJ45的线可能不兼容**  
   市面上有些 USB 转 RJ45 的线**不兼容思科定义**（比如 CH340 方案的某些线），引脚5可能会输出电压导致乱码或完全没反应。

2. **买线时认准关键词**  
   建议买标注 **"Cisco兼容"** 或 **"Rollover"** 的 Console 线，别买成普通的 USB 转网口（那是给笔记本电脑没网口时用的）。

3. **笔记本没串口怎么办**  
   需要两样东西：
   - Console 线（RJ45 转 DB9）
   - USB 转 DB9 串口线（带 CH340 或 FTDI 芯片的）

   或者直接买 **USB 转 RJ45 的思科专用 Console 线**，一根搞定。

4. **插上没反应先查这几项**  
   - 线插对了吗（Console 口不是网口）
   - 驱动装了吗（设备管理器里有没有 COM 口）
   - 流控关了吗（RTS/CTS 必须关）
   - 波特率是 9600 吗

---

### 为什么这些破事这么复杂？

因为 RS-232 标准诞生于上个世纪，那时候没人想到今天会有人用 USB 连它。

思科只是选了个 RJ45 的物理接口，里面跑的还是老掉牙的串口协议。

所以你现在才会看到：
- RJ45 形状的接口（看着像网口）
- RS-232 的信号（不是网络信号）
- 反转的线序（rollover 线）

**习惯就好。**

</details>

---

## 为什么要用Console？

因为你第一次拿到设备的时候，它应该**啥配置都没有**。

- 没有IP地址
- 没有管理VLAN
- 不知道密码
- 甚至不知道它有没有启动完

这时候你想进去敲命令？SSH？没配。Telnet？更不可能。Web界面？想都别想。

唯一能进去的路，就是Console。

**你可能在找：如果你的设备有配置，有密码或无法登入，请参见后文[2.12 重制与重载](reset.md)**

---

## 怎么连？

你需要三样东西：

1. **Console线**  
   一端是RJ45，一端是串口（或者直接USB）。新点的笔记本没串口？买USB转串口的线，或者找带USB头的Console线。

2. **终端软件**  
   - **Windows**：PuTTY、SecureCRT、Xshell（站长在用） 
   - **Mac**：screen 命令，或者 SecureCRT  
   - **Linux**：minicom、screen

3. **正确的设置**  
   别管你是思科还是华为，参数都一样：
```

波特率：9600
数据位：8
停止位：1
校验：无
流控：无

```

---

## 踩坑记录

### 1. 线插上了，软件打开了，啥也没有

**原因**：线坏了，或者驱动没装。  
有些USB转串口的线要装驱动。插上后去设备管理器看看有没有出现新的COM口。  
如果是USB转RJ45的线（比如思科的蓝线），一般是即插即用，但也有例外。

### 2. 有输出，但敲键盘没反应

**原因**：流控没关。  
把RTS/CTS、XON/XOFF全部关掉。只要设成None。

### 3. 一堆乱码

**原因**：波特率不对。  
确认是9600。有些设备启动时会在某个阶段改波特率（比如IOS的ROMmon模式），但正常情况下就是9600。

### 4. 华为（H3C可能也会）设备，插上console直接输命令，没提示输密码 & 我重置过了怎么还有密码？

**原因**：华为不同版本不同设备的策略不同。

这是华为自己的问题。或许第一次连上华为设备，你可能直接就进用户视图了，抑或遇到了username和password的地狱。

- admin admin@huawei.com

事已至此，试试看吧。

### 5. 线是对的，设置是对的，但就是连不上

**原因**：可能是Console线插错口了。  
有些设备有多个RJ45口，只有标着"Console"或"CON"的那个才是。别插到AUX口或者管理网口上。

### 6. 天杀的！为什么这么卡！还给我卡蓝屏了？？？

**原因**：你可能需要去设备管理器关掉FIFO缓冲区。
FIFO（First In First Out）缓冲区，简单说就是串口设备的一个**缓存机制**。
Windows 默认会开这个东西，目的是让数据传输更顺畅。但问题是：

- 它和某些老设备（或者某些USB转串口线的驱动）**八字不合**
- 开着的后果：输入延迟、输出乱码、终端软件卡死、甚至**直接死给你看**

---

## 小技巧

### 保存会话日志
连console的时候，建议在终端软件里开日志记录。  
万一你配到一半设备重启了，还能回头看看刚才敲了啥。

### 波特率不对的时候
有时候设备启动过程中会提示：
```

Press Ctrl+B to enter boot menu...

```
这时候如果你敲不进，多半是波特率不是9600。有些设备启动菜单用的波特率是115200，可以试试看。

### 多备几条线
Console线这东西，说坏就坏。手边最好备两条，一条USB转串口，一条USB转RJ45直连的（思科那种蓝线）。

---

## 设备间的小差异

| 设备 | Console默认密码 | 特殊说明 |
|------|----------------|----------|
| 思科交换机/路由器 | 默认无密码，但需要配 | 如果配置了`line console 0`但没有`login`，直接进 |
| 华为交换机/路由器 | 部分默认无密码，直接进（注：需要看设备版本。部分设备有默认账号密码） | 进用户视图后需要`system-view`进配置模式 |
| 华三 | 默认无密码，直接进 | 和华为基本一样，毕竟是同源 |
| 锐捷 | 默认无密码，但需要enable密码进特权 | 用户视图直接进，但`enable`需要密码 |

---

## 最后想说的

Console口是你和设备最原始的连接方式。  

不管你是配几千块的傻瓜交换机，还是几十万的核心路由器，第一次见面，都是通过这根线。

哦，几百块的那种没有网管功能的没有。
